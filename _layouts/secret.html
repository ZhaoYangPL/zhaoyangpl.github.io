---
layout: page
---

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
  #secret-container { text-align: center; padding: 20px 0; }
  #secret-controls { margin-bottom: 20px; }
  #secret-content { text-align: left; background-color: #252526; border: 1px solid #333; padding: 20px 40px; border-radius: 8px; color: #e2e2e2; }
  #secret-container input { font-size: 1em; padding: 10px; border-radius: 5px; border: 1px solid #555; background-color: #3d3d3d; color: #fff; }
  #secret-container button { font-size: 1em; padding: 10px 20px; border-radius: 5px; border: none; background-color: #007acc; color: white; cursor: pointer; }
  #secret-content h1, #secret-content h2, #secret-content h3 { color: #ccc; }
  #secret-content a { color: #3794ff; }
</style>

<div id="secret-container">
  <h2 id="page-title">请输入密码访问</h2>
  <div id="secret-controls">
    <input type="password" id="password-input" placeholder="请输入密码...">
    <button id="decrypt-button">解密</button>
  </div>
  <div id="secret-content" style="display:none;"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const encryptedContent = {{ content | strip | jsonify }};
    const passwordInput = document.getElementById('password-input');
    const decryptButton = document.getElementById('decrypt-button');
    const contentDiv = document.getElementById('secret-content');
    const controlsDiv = document.getElementById('secret-controls');
    const titleHeader = document.getElementById('page-title');

    function decrypt() {
      const password = passwordInput.value;
      if (!password) {
        alert("请输入密码！");
        return;
      }
      try {
        const decrypted = CryptoJS.AES.decrypt(encryptedContent, password);
        const plaintext = decrypted.toString(CryptoJS.enc.Utf8);

        if (plaintext) {
          contentDiv.innerHTML = marked.parse(plaintext);
          contentDiv.style.display = 'block';
          controlsDiv.style.display = 'none';
          titleHeader.innerText = "{{ page.title }}";
        } else {
          throw new Error('Decryption failed');
        }
      } catch (e) {
        alert("密码错误！");
        passwordInput.value = '';
      }
    }

    // 使用现代事件监听器来绑定事件
    decryptButton.addEventListener('click', decrypt);
    passwordInput.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        decrypt();
      }
    });
  });
</script>