---
title: "Quant Notes_COnfusions(CourseNotes for Study & Research Only)"
subtitle: "Some Confusions"
date: 2025-10-15 12:02:00 +0800
categories: [Notes,Quant]  
tags: [Quant,Notes]
---

### ç‚ºä»€éº¼ Position çš„ç¶“å¸¸è®ŠåŒ–æœƒä¸å¤ªå¥½ï¼Ÿ (é«˜æ›æ‰‹çŽ‡å•é¡Œ)

é€™å€‹å•é¡Œçš„æ ¸å¿ƒæ˜¯äº¤æ˜“æˆæœ¬å’Œä¿¡è™Ÿè³ªé‡ã€‚é »ç¹åœ°æ”¹è®Šå€‰ä½ï¼Œåœ¨é‡åŒ–é ˜åŸŸè¢«ç¨±ç‚ºé«˜æ›æ‰‹çŽ‡ (High Turnover)ã€‚é«˜æ›æ‰‹çŽ‡æœƒå¸¶ä¾†å¹¾å€‹è‡´å‘½å•é¡Œï¼š

äº¤æ˜“æˆæœ¬ (Transaction Costs): é€™æ˜¯æœ€ç›´æŽ¥çš„ã€‚æ¯ä¸€æ¬¡è²·å…¥æˆ–è³£å‡ºéƒ½ä¸æ˜¯å…è²»çš„ï¼Œä½ éœ€è¦æ”¯ä»˜æ‰‹çºŒè²»ã€ç¨…é‡‘ç­‰ã€‚å¦‚æžœä½ çš„ç­–ç•¥æ¯å¤©éƒ½åœ¨é »ç¹äº¤æ˜“ï¼Œé€™äº›æˆæœ¬æœƒåƒç™½èŸ»ä¸€æ¨£ï¼Œä¸æ–·ä¾µè•ä½ çš„åˆ©æ½¤ï¼Œå“ªæ€•ç­–ç•¥æœ¬èº«æ˜¯ç›ˆåˆ©çš„ã€‚

**å¸‚å ´è¡æ“Š/æ»‘åƒ¹** (Market Impact/Slippage): ç•¶ä½ é€²è¡Œå¤§é¡äº¤æ˜“æ™‚ï¼Œä½ çš„è²·å–®æœƒæŽ¨é«˜åƒ¹æ ¼ï¼Œè³£å–®æœƒå£“ä½Žåƒ¹æ ¼ã€‚ä½ å¯¦éš›æˆäº¤çš„åƒ¹æ ¼ï¼Œå¾€å¾€æœƒæ¯”ä½ ä¸‹å–®æ™‚çœ‹åˆ°çš„åƒ¹æ ¼è¦å·®ä¸€äº›ã€‚äº¤æ˜“è¶Šé »ç¹ï¼Œé€™ç¨®â€œæ»‘åƒ¹â€é€ æˆçš„æå¤±å°±è¶Šå¤§ã€‚

ä¿¡è™Ÿä¸ç©©å®š: ä¸€å€‹æ¯å¤©éƒ½åœ¨â€œè²·å…¥â€å’Œâ€œè³£å‡ºâ€ä¹‹é–“åè¦†æ©«è·³çš„ä¿¡è™Ÿï¼Œå¾ˆå¯èƒ½åªæ˜¯æ•æ‰åˆ°äº†å¸‚å ´çš„éš¨æ©Ÿ**â€œå™ªéŸ³â€ (Noise)ï¼Œè€Œä¸æ˜¯ä¸€å€‹ç©©å®šã€å¯æŒçºŒçš„â€œä¿¡è™Ÿâ€ (Signal)**ã€‚æˆ‘å€‘å¸Œæœ›äº¤æ˜“çš„æ˜¯é‚£äº›èƒ½å¤ æŒçºŒä¸€æ®µæ™‚é–“çš„ã€å¯ä¿¡çš„è¦å¾‹ï¼Œè€Œä¸æ˜¯æ›‡èŠ±ä¸€ç¾çš„å¸‚å ´æ³¢å‹•ã€‚

ç¸½çµï¼š**ä¸€å€‹å¥½çš„Alphaå› å­ï¼Œå…¶ç”¢ç”Ÿçš„å€‰ä½ä¿¡è™Ÿæ‡‰è©²æ˜¯ç›¸å°ç©©å®šçš„ã€‚**

### ç‚ºä»€éº¼è¦ä½¿ç”¨ decayï¼Ÿ
ç¾åœ¨æˆ‘å€‘çŸ¥é“äº†â€œå€‰ä½é »ç¹è®ŠåŒ–æ˜¯ä¸å¥½çš„â€ï¼Œé‚£éº¼å¦‚ä½•è§£æ±ºé€™å€‹å•é¡Œå‘¢ï¼Ÿdecay å°±æ˜¯è§£æ±ºæ–¹æ¡ˆä¹‹ä¸€ã€‚

decayï¼ˆè¡°æ¸›ï¼‰åœ¨WorldQuant BRAINé€™é¡žå¹³å°ä¸­ï¼Œé€šå¸¸æŒ‡æ™‚é–“åºåˆ—ä¸Šçš„å¹³æ»‘è™•ç†ï¼Œæœ€å¸¸è¦‹çš„å¯¦ç¾æ˜¯æŒ‡æ•¸åŠ æ¬Šç§»å‹•å¹³å‡ (Exponential Moving Average, EMA)ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³åƒæˆä¸€å€‹â€œæ¿¾æ³¢å™¨â€ã€‚

å®ƒçš„ä½œç”¨: decayæœƒè¨ˆç®—ä¸€å€‹ä¿¡è™Ÿåœ¨éŽåŽ»ä¸€æ®µæ™‚é–“ï¼ˆæ¯”å¦‚10å¤©ï¼‰çš„åŠ æ¬Šå¹³å‡å€¼ï¼Œå…¶ä¸­è¶Šè¿‘çš„æ•¸æ“šæ¬Šé‡è¶Šé«˜ï¼Œè¶Šé çš„æ•¸æ“šæ¬Šé‡è¶Šä½Žä½†ä»æœ‰å½±éŸ¿ã€‚

å®ƒçš„ç›®çš„: é€šéŽé€™ç¨®åŠ æ¬Šå¹³å‡ï¼Œå®ƒå¯ä»¥æ¿¾æŽ‰ä¿¡è™Ÿä¸­é‚£äº›çŸ­æœŸçš„ã€ç„¡æ„ç¾©çš„â€œå™ªéŸ³â€ï¼Œè®“ä¿¡è™Ÿçš„é•·æœŸè¶¨å‹¢æ›´åŠ çªé¡¯ã€‚


### çŽ°åœ¨æˆ‘æ‰¾äº†å¦å¤–çš„data fieldï¼Œé‚£ä¹ˆçŽ°åœ¨rank çš„åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè€Œä¸”ä¸ºä»€ä¹ˆä¸€ä¸ªç®€å•çš„rankï¼ˆï¼‰ä¹Ÿç®—ä½œä¸€ä¸ªAlphaï¼Œå®ƒä¸è¿‡æ˜¯æŠŠæ˜¯è‚¡ç¥¨æŽ’åºï¼ŒåŽé¢çš„æ•°æ®æ˜¯æ€Žä¹ˆç®—å‡ºæ¥çš„ï¼ˆå…·ä½“çš„æœºç†æ˜¯æ€Žæ ·çš„ï¼‰ï¼Ÿç„¶åŽä¸ºä»€ä¹ˆæˆ‘å°è¯•æ–°çš„data fieldä»¥åŽç»“æžœè¿™ä¹ˆå·®?

![](/assets/img/Course/newFieldCode.png)

![](/assets/img/Course/settings.png)

![](/assets/img/Course/newFieldResult.png)


1. "çŽ°åœ¨rank çš„åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ" (What exactly is being ranked now?)

You used the data field sci12_sentiment. This is likely a numerical score representing the news and social media sentiment for each stock. So, the expression rank(sci12_sentiment) does the following every single day of the simulation:

It looks at all the stocks in your universe (e.g., TOP1000).

It gets the sci12_sentiment score for each of those 1000 stocks on that specific day.

It then ranks those 1000 sentiment scores from lowest to highest.

Example for a single day:

Ticker	sci12_sentiment (Raw Score)	rank(sci12_sentiment) (Alpha Signal)
AAPL	0.85 (Very Positive)	0.95 (e.g., Top 5%)
MSFT	0.60 (Positive)	0.80 (e.g., Top 20%)
XOM	-0.10 (Slightly Negative)	0.40 (e.g., Bottom 40%)
T	-0.90 (Very Negative)	0.05 (e.g., Bottom 5%)
So, you are ranking the relative sentiment of stocks against their peers on a daily basis.

2. "ä¸ºä»€ä¹ˆä¸€ä¸ªç®€å•çš„rank()ä¹Ÿç®—ä½œä¸€ä¸ªAlphaï¼Œå®ƒä¸è¿‡æ˜¯æŠŠè‚¡ç¥¨æŽ’åºï¼ŒåŽé¢çš„æ•°æ®æ˜¯æ€Žä¹ˆç®—å‡ºæ¥çš„ï¼Ÿ" (Why is a simple rank() an Alpha, and how are the metrics calculated?)

This is the magic of the backtesting engine. A simple rank() expression is considered an Alpha because it represents a complete, testable trading hypothesis.

Your hypothesis is: "I believe that stocks with higher sentiment today will have better returns tomorrow compared to stocks with lower sentiment."

Here is the mechanism the platform uses to test this hypothesis and calculate the results:

Signal to Position: The platform's simulator takes your Alpha's output (the daily ranks from 0 to 1) and converts it into a target portfolio. It aims to be market-neutral.

High Rank (e.g., > 0.9): Take a Long position (Buy).

Low Rank (e.g., < 0.1): Take a Short position (Sell).

Middle Rank: Take no position (Flat).

Daily Simulation (Backtest):

On Day 1: It calculates the ranks and "pretends" to buy the high-sentiment stocks and short the low-sentiment stocks.

On Day 2: It looks at the real-world returns of the stocks from Day 1. It calculates how much money the portfolio made or lost (this is the daily PnL - Profit and Loss).

Rebalancing: Also on Day 2, it recalculates the sentiment ranks for all stocks. The target portfolio might change. For example, AAPL's rank might drop, so the simulator "sells" some AAPL. This creates Turnover.

Repeat: This process repeats for every single day in the test period (e.g., from 2018 to 2023).

From Daily PnL to Final Metrics:
After the simulation finishes, the platform has a long list of daily PnL values. It uses this list to calculate all the statistics you see in the first screenshot:

Returns: The cumulative sum of the daily PnL.

Sharpe Ratio: The risk-adjusted return, calculated from the mean and standard deviation of the daily PnL.

Drawdown: The largest peak-to-trough drop in the cumulative PnL curve.

Turnover: How much buying and selling was required each day to maintain the target portfolio.

So, an "Alpha" isn't just a ranking; it's the entire strategy implied by that ranking, which the platform automatically simulates for you.

3. "ä¸ºä»€ä¹ˆæˆ‘å°è¯•æ–°çš„data fieldä»¥åŽç»“æžœè¿™ä¹ˆå·®ï¼Ÿ" (Why are my results so bad?)

Welcome to the real world of quantitative research! This is the most common experience for a researcher. Over 99% of initial ideas fail. Here are the most likely reasons your results are poor:

The Hypothesis is Wrong: The most simple reason. It's possible that high news sentiment has no actual predictive power over the next day's stock returns. The market may have already priced in that sentiment.

Timing is Off (Lead/Lag Effects): The signal might be too early or too late. Maybe sentiment today predicts returns in two days, not one. To test this, you'd need to use a delay() operator, like rank(delay(sci12_sentiment, 2)).

The Signal is Too Noisy: Raw data fields like sentiment can be very volatile and "noisy." A signal that jumps around every day leads to high Turnover (as seen in your screenshot, 66% is quite high), and transaction costs eat all the potential profits. The standard solution is to smooth the signal using an operator like decay_linear(), which we discussed.

The Signal Needs Neutralization: The sentiment signal might have a built-in bias. For example, maybe tech stocks always have higher sentiment scores than utility stocks. If tech stocks performed poorly in a given year, your alpha would also perform poorly. You might need to neutralize the signal against sectors or industries to remove these biases.

### `rank(ts_decay_linear(-scl12_sentiment,5))` quite weirdï¼Œpoor performance In train set, but good in test set

![](/assets/img/Course/WeirdTrain.png)

![](/assets/img/Course/WeirdTest.png)

#### The Core Reason: A Change in Market Regime ðŸ„
Think of your alpha strategy as a specific type of surfboard. Your reversal strategy is like a specialized shortboard designed for fast, steep waves.

The Train Set (2018-2022): Let's imagine the market during this period was like an ocean with small, choppy, or long, rolling waves. In this environment, your specialized shortboard (your reversal alpha) doesn't work well. This might have been a "momentum-driven" market where buying winners and selling losers was the dominant trend. Your reversal strategy would have consistently lost money, which is reflected in your poor training set results (Sharpe 0.46).

The Test Set (e.g., 2023): Suddenly, the market conditions changed. The ocean started producing the perfect, steep waves your shortboard was designed for. This might have been a volatile, news-driven, or range-bound market where sentiment overreacted, and betting against the crowd (reversal) was highly profitable. Your alpha suddenly performed brilliantly (Sharpe 1.73).

Looking at your data, the entire positive performance of your alpha comes almost exclusively from the year 2023 (Sharpe = 4.04), which was likely your test period. This is a massive clue.

#### Why This is a Red Flag ðŸš© (The Danger of False Confidence)
While a high Sharpe ratio in the test set looks exciting, this situation is actually a major red flag.

It's Not Robust: A good alpha strategy should be like an all-purpose longboardâ€”it might not be the best on any single type of wave, but it performs reasonably well in most conditions. Your strategy is a "one-trick pony." It only works in a very specific type of market that might not appear again for years.

It's Likely Luck: Your success in the test set is probably not because you found a genuinely brilliant, persistent signal. It's more likely that you got luckyâ€”your test period just happened to be the perfect storm for your specific idea.

Unreliable for the Future: You cannot trust this alpha to make money in the future. If the market regime shifts back to the 2018-2022 style, your strategy will start losing money again, just as it did in the training set.

In quantitative finance, **consistency across different time periods and market conditions is far more important than a spectacular result in a single, short period**. Your training set, in this case, is actually giving you a more honest (and worrying) picture of the strategy's typical performance.

### But how could i control the turnover, making it lower? Choosing another dataset or operator?

![](/assets/img/Course/HighTurnover.png)

#### 1. Smooth Your Signal with decay Operators (The Best Method) smoothing
This is the most common and powerful technique. Think of decay operators like ts_decay_linear as a filter that smooths out the daily "noise" from your signal, revealing the underlying trend. It calculates a weighted average of your signal over a recent period (e.g., the last 10 days), which makes the final output change much more gradually.

By making the signal smoother, the target positions don't jump around as much, which directly leads to lower turnover.

How to Apply It:
Wrap your entire existing expression in a decay operator. A window of 5 to 20 days is a good starting point.

Try this expression:

ts_decay_linear( ((-ts_rank(returns, 252)) * (vwap / close)), 10)
ts_decay_linear(..., 10) tells the system to calculate a 10-day smoothed, weighted average of the signal inside the parentheses. This will dramatically reduce the day-to-day fluctuations and lower your turnover.

#### 2. Use Slower-Moving Data Fields ðŸ¢
The root cause of your high turnover is the use of returns, which measures a 1-day change. A more stable approach is to base your alpha on data that doesn't change as quickly.

Instead of returns, consider using:

Longer-Term Momentum: Calculate returns over a longer period. The expression for a 20-day return is (close - delay(close, 20)) / delay(close, 20). This value is inherently more stable than a 1-day return.

Fundamental Data: This is what the tutorial hinted at with the fn_liab_fair_val_1_a example. Fundamental data (like revenue, debt, assets) is reported quarterly or annually, making it a very low-turnover signal by nature.