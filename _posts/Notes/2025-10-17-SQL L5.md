---
title: "SQL L5(CourseNotes for Study & Research Only)"
date: 2025-10-17 19:25:00 +0800
categories: [Notes,Database]  
tags: [Database]
---

# 数据完整性控制机制

* 必须有值的数据

**关键字：NOT NULL**

* 域约束（check约束）

限制列中可接受的值，使其符合特定的逻辑条件。 定义一个返回 TRUE或 FALSE的逻辑表达式。只有使表达式为 TRUE的值才能插入或更新到列中。

1. 列级 CHECK 约束，直接放在列名后

```SQL
CREATE TABLE Students (
student_id INT IDENTITY(1,1) PRIMARY KEY,
name VARCHAR(100) NOT NULL,
age INT CHECK (age BETWEEN 16 AND 80),
gender VARCHAR(10) CHECK (gender IN ('Male', 'Female', 'Other')),
email VARCHAR(255) CHECK (email LIKE '%@%.%'),
enrollment_date DATE CHECK (enrollment_date >= '2000-01-01'),
gpa DECIMAL(3,2) CHECK (gpa BETWEEN 0.00 AND 4.00)
);
```

2. 表级 CHECK 约束，放在所有列后(便于修改)

```sql
CREATE TABLE Students (
student_id INT IDENTITY(1,1) PRIMARY KEY,
name VARCHAR(100) NOT NULL,
age INT,
gender VARCHAR(10),
email VARCHAR(255),
enrollment_date DATE,
major VARCHAR(50),
gpa DECIMAL(3,2),
-- 域约束作为表级 CHECK 约束
 CONSTRAINT CHK_Student_Age CHECK (age BETWEEN 16 AND 80),
CONSTRAINT CHK_Student_Gender CHECK (gender IN ('Male', 'Female', 'Other')),
CONSTRAINT CHK_Student_Email CHECK (email LIKE '%@%.%' AND LEN(email) >= 5),
CONSTRAINT CHK_Student_GPA CHECK (gpa BETWEEN 0.00 AND 4.00),
CONSTRAINT CHK_Student_EnrollmentDate CHECK (enrollment_date >= '2000-01-01')
);
```

**使用CONSTRAINT的一个优势是可以更灵活地删除或更改约束来适应业 务规则的变化。添加约束：ALTER TABLE … ADD CONSTRAINT …;删除约束：ALTER TABLE … DROP CONSTRAINT …**

* 实体完整性：

1. 一个表中每一行的主码值必须是非空且唯一(unique)的

2. 每个表只有一个primary key，但可以用unique保证其他列的唯一性。注意unique中的每个列都必须是NOT NULL的

* 引用完整性：

外部关键词必须是母表（即被引用的表）中已存在的有效元组

![alt text](/assets/img/Course/引用完整性.png)

![alt text](/assets/img/Course/引用.png)

```sql
FOREIGN KEY (student_id) REFERENCES Students
ON DELETE SET NULL

FOREIGN KEY (course_id) REFERENCES Courses
ON UPDATE CASCADE
```

* 添加、删除外键约束

![](/assets/img/Course/添加删除外键约束.png)

# 数据库模式

![](/assets/img/Course/schema.png)

![](/assets/img/Course/CreateTable.png)

![](/assets/img/Course/AdjustDefinition.png)

